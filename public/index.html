<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CardsLawp</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_SANDBOX_CLIENT_ID&currency=USD"></script>
</head>
<body>
  <header class="navbar glassy">
    <h1>CardsLawp</h1>
    <nav>
      <button id="loginBtn" class="cta">Login</button>
      <button id="viewCart" class="cta">Cart</button>
    </nav>
  </header>

  <main>
    <section id="productsContainer" class="product-grid"></section>
  </main>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <h3>Login</h3>
      <input id="loginEmail" placeholder="Email">
      <input id="loginPass" type="password" placeholder="Password">
      <button id="loginSubmit" class="cta">Login</button>
    </div>
  </div>

  <!-- Cart Modal -->
  <div class="modal" id="cartModal">
    <div class="modal-content">
      <h3>Your Cart</h3>
      <div id="cartItems"></div>
      <input id="buyerEmail" placeholder="Enter your email">
      <div id="paypal-button-container"></div>
    </div>
  </div>

  <script>
let loggedInEmail = null;
let cart = [];

// Load products
async function loadProducts() {
  const res = await fetch('/api/products');
  const products = await res.json();
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';

  products.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.desc}</p>
      <p class="price">$${p.price}</p>
      <button class="cta">Add to Cart</button>
    `;
    card.querySelector('button').addEventListener('click', () => addToCart(p));
    container.appendChild(card);
  });
}
loadProducts();

function addToCart(p) {
  cart.push(p);
  alert(p.name + " added to cart");
}

document.getElementById('viewCart').addEventListener('click', () => {
  const cartModal = document.getElementById('cartModal');
  const itemsDiv = document.getElementById('cartItems');
  itemsDiv.innerHTML = cart.map(c => `<p>${c.name} - $${c.price}</p>`).join('');
  cartModal.style.display = 'flex';

  paypal.Buttons({
    createOrder: async () => {
      const buyerEmail = document.getElementById('buyerEmail').value;
      const res = await fetch('/api/create-order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ cart, buyerEmail })
      });
      const data = await res.json();
      return data.id;
    },
    onApprove: async (data) => {
      const buyerEmail = document.getElementById('buyerEmail').value;
      await fetch('/api/capture-order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ orderID: data.orderID, buyerEmail, cart })
      });
      alert("Payment successful! Please wait for your gift card in your email.");
      cart = [];
      document.getElementById('cartModal').style.display = 'none';
    }
  }).render('#paypal-button-container');
});

document.getElementById('loginBtn').addEventListener('click', () => {
  document.getElementById('loginModal').style.display = 'flex';
});
document.getElementById('loginSubmit').addEventListener('click', async () => {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPass').value;
  const res = await fetch('/api/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ email, password })
  });
  const data = await res.json();
  loggedInEmail = email;
  alert(`Logged in as ${email}`);
  if (data.admin) window.location.href = "/admin";
  document.getElementById('loginModal').style.display = 'none';
});
  </script>
</body>
</html>