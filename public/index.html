<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CardsLawp | Gift Cards Store</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">CardsLawp</div>
    <div class="nav-links">
      <a href="#" id="homeTab" class="active">Home</a>
      <a href="#" id="requestTab">Suggest</a>
      <a href="#" id="adminTab" style="display:none;">Admin</a>
      <a href="#" id="loginBtn">Login</a>
    </div>
  </nav>

  <!-- Hero -->
  <header class="hero">
    <h1>Buy Gift Cards Instantly</h1>
    <p>Fast, secure, and easy digital gift card store.</p>
    <button class="hero-btn">Shop Now</button>
  </header>

  <!-- Gift Cards Section -->
  <section class="cards-container" id="productSection">
    <!-- Gift cards are dynamically loaded from backend -->
  </section>

  <!-- Suggest Gift Card Section -->
  <section class="suggest fade" id="suggestSection" style="display:none;">
    <h2>Suggest a New Gift Card</h2>
    <input id="reqName" placeholder="Gift Card Name">
    <input id="reqImg" placeholder="Image URL">
    <textarea id="reqDesc" placeholder="Description"></textarea>
    <button id="reqSubmit">Submit Request</button>
  </section>

  <!-- Admin Panel Section -->
  <section class="admin fade" id="adminPanel" style="display:none;">
    <h2>Admin Requests</h2>
    <div id="requestsList"></div>
  </section>

  <!-- Item Preview Modal -->
  <div class="modal" id="itemModal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="modalImg" src="">
      <h2 id="modalTitle"></h2>
      <p id="modalDesc"></p>
      <div class="modal-actions">
        <button class="addCartBtn">Add to Cart</button>
        <button class="buyNowBtn">Buy Now</button>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content login-box">
      <span class="close" onclick="closeLogin()">&times;</span>
      <h2>Admin Login</h2>
      <input type="text" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button id="loginSubmit">Login</button>
    </div>
  </div>

  <script>
    // Fade-in scroll animation
    const fades = document.querySelectorAll('.fade');
    window.addEventListener('scroll', () => {
      fades.forEach(el => {
        const rect = el.getBoundingClientRect();
        el.style.opacity = rect.top < window.innerHeight - 100 ? 1 : 0;
      });
    });

    // Tabs logic
    const homeTab = document.getElementById('homeTab');
    const requestTab = document.getElementById('requestTab');
    const adminTab = document.getElementById('adminTab');
    const productSection = document.getElementById('productSection');
    const suggestSection = document.getElementById('suggestSection');
    const adminPanel = document.getElementById('adminPanel');

    homeTab.onclick = () => {
      productSection.style.display = 'flex';
      suggestSection.style.display = 'none';
      adminPanel.style.display = 'none';
    };
    requestTab.onclick = () => {
      productSection.style.display = 'none';
      suggestSection.style.display = 'block';
      adminPanel.style.display = 'none';
    };

    // Fetch gift cards
    async function loadCards() {
      const res = await fetch('/api/cards');
      const cards = await res.json();
      productSection.innerHTML = cards.map(c => `
        <div class="card fade">
          <img src="${c.image}" alt="${c.name}">
          <h2>${c.name}</h2>
          <p>${c.description}</p>
          <button class="view-btn" onclick="showItem('${c.name}','${c.image}','${c.description}')">View</button>
        </div>
      `).join('');
    }
    loadCards();

    // Item modal
    function showItem(title, img, desc) {
      document.getElementById('itemModal').style.display = 'flex';
      document.getElementById('modalTitle').innerText = title;
      document.getElementById('modalImg').src = img;
      document.getElementById('modalDesc').innerText = desc;
    }
    function closeModal() {
      document.getElementById('itemModal').style.display = 'none';
    }

    // Submit gift card request
    document.getElementById('reqSubmit').onclick = async () => {
      const name = reqName.value;
      const image = reqImg.value;
      const description = reqDesc.value;
      const res = await fetch('/api/request', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({name,image,description})
      });
      const data = await res.json();
      alert(data.message);
      reqName.value = reqImg.value = reqDesc.value = '';
    };

    // Login modal
    document.getElementById('loginBtn').onclick = () => {
      document.getElementById('loginModal').style.display = 'flex';
    };
    function closeLogin() {
      document.getElementById('loginModal').style.display = 'none';
    }

    // Admin login
    document.getElementById('loginSubmit').onclick = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({email,password})
      });
      const data = await res.json();
      if (data.success) {
        adminTab.style.display = 'inline';
        alert('Logged in as admin');
      } else {
        alert('Invalid login');
      }
    };

    // Admin tab
    adminTab.onclick = async () => {
      productSection.style.display = 'none';
      suggestSection.style.display = 'none';
      adminPanel.style.display = 'block';
      const res = await fetch('/api/admin/requests');
      const requests = await res.json();
      const list = document.getElementById('requestsList');
      list.innerHTML = requests.map(r => `
        <div class="request-item">
          <img src="${r.image}" width="100">
          <p><b>${r.name}</b><br>${r.description}</p>
          <button onclick="approve(${r.id})">Approve</button>
          <button onclick="deny(${r.id})">Deny</button>
        </div>
      `).join('');
    };

    async function approve(id){
      await fetch('/api/admin/approve/'+id,{method:'POST'});
      alert('Approved!');
      adminTab.click();
      loadCards();
    }
    async function deny(id){
      await fetch('/api/admin/deny/'+id,{method:'POST'});
      alert('Denied.');
      adminTab.click();
    }
  </script>
</body>
</html>