<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CardsLawp | Gift Cards</title>
  <link rel="stylesheet" href="/style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- ===== NAVBAR ===== -->
  <div class="navbar">
    <div class="logo"><i data-lucide="credit-card"></i> CardsLawp</div>
    <div class="nav-links">
      <a href="/" class="active"><i data-lucide="home"></i> Home</a>
      <a href="/cart"><i data-lucide="shopping-cart"></i> Cart</a>
      <a href="/login"><i data-lucide="user"></i> Login</a>
    </div>
  </div>

  <!-- ===== HERO SECTION ===== -->
  <section class="hero fade">
    <h1><i data-lucide="gift"></i> Welcome to CardsLawp</h1>
    <p>Buy digital gift cards instantly â€” fast, secure, and verified.</p>
    <button class="hero-btn" onclick="scrollToCards()"><i data-lucide='shopping-bag'></i> Shop Now</button>
  </section>

  <!-- ===== PRODUCT CARDS ===== -->
  <section id="products" class="cards-container fade">
    <!-- Cards will be loaded here -->
  </section>

  <!-- ===== CART SIDEBAR ===== -->
  <div id="cartSidebar">
    <h2><i data-lucide="shopping-cart"></i> Your Cart</h2>
    <div id="cartItems"></div>
    <button id="checkoutBtn"><i data-lucide="credit-card"></i> Pay with PayPal</button>
  </div>

  <!-- ===== MODAL FOR PRODUCT DETAILS ===== -->
  <div class="modal" id="productModal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="modalImage" src="" alt="">
      <h2 id="modalTitle"></h2>
      <p id="modalDesc"></p>
      <p id="modalPrice"></p>
      <button class="addCartBtn" id="modalAddBtn"><i data-lucide="plus-circle"></i> Add to Cart</button>
    </div>
  </div>

  <script>
    // ===== SCROLL TO CARDS =====
    function scrollToCards() {
      document.getElementById('products').scrollIntoView({behavior: 'smooth'});
    }

    // ===== LOAD PRODUCTS =====
    fetch('/api/items')
      .then(res => res.json())
      .then(items => {
        const container = document.querySelector('.cards-container');
        container.innerHTML = '';
        items.forEach(item => {
          const card = document.createElement('div');
          card.classList.add('card', 'fade');
          card.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <h2>${item.name}</h2>
            <p>${item.description}</p>
            <p><b>$${item.price}</b></p>
            <button onclick="openModal('${item._id}', '${item.image}', '${item.name}', '${item.description}', ${item.price})">
              <i data-lucide="eye"></i> View
            </button>`;
          container.appendChild(card);
        });
        lucide.createIcons();
      });

    // ===== MODAL =====
    function openModal(id, img, title, desc, price) {
      document.getElementById('modalImage').src = img;
      document.getElementById('modalTitle').innerText = title;
      document.getElementById('modalDesc').innerText = desc;
      document.getElementById('modalPrice').innerText = `$${price}`;
      document.getElementById('productModal').style.display = 'flex';
      document.getElementById('modalAddBtn').onclick = () => addToCart(id);
    }

    function closeModal() {
      document.getElementById('productModal').style.display = 'none';
    }

    // ===== CART =====
    function addToCart(id) {
      fetch('/api/cart/add', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({id})
      }).then(() => alert('Item added to cart!'));
    }

    // ===== FADE ANIMATIONS (DISABLE ON MOBILE) =====
    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    if (!isMobile) {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.remove('fade');
          else entry.target.classList.add('fade');
        });
      }, { threshold: 0.2 });

      document.querySelectorAll('.fade').forEach(el => observer.observe(el));
    }

    lucide.createIcons();
  </script>
</body>
</html>